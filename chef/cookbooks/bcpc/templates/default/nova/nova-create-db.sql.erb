CREATE DATABASE IF NOT EXISTS <%= @db['dbname'] %>;
CREATE DATABASE IF NOT EXISTS nova_api;
CREATE DATABASE IF NOT EXISTS nova_cell0;

CREATE USER IF NOT EXISTS '<%= @db['username'] %>'@'localhost' \
  IDENTIFIED WITH 'mysql_native_password' BY '<%= @db['password'] %>';

GRANT ALL PRIVILEGES \
  ON <%= @db['dbname'] %>.* \
  TO '<%= @db['username'] %>'@'localhost';

CREATE USER IF NOT EXISTS '<%= @db['username'] %>'@'%' \
  IDENTIFIED WITH 'mysql_native_password' BY '<%= @db['password'] %>';

GRANT ALL PRIVILEGES \
  ON <%= @db['dbname'] %>.* \
  TO '<%= @db['username'] %>'@'%';

GRANT ALL PRIVILEGES \
  ON nova_api.* \
  TO '<%= @db['username'] %>'@'localhost';

GRANT ALL PRIVILEGES \
  ON nova_api.* \
  TO '<%= @db['username'] %>'@'%';

GRANT ALL PRIVILEGES \
  ON nova_cell0.* \
  TO '<%= @db['username'] %>'@'localhost';

GRANT ALL PRIVILEGES \
  ON nova_cell0.* \
  TO '<%= @db['username'] %>'@'%';
