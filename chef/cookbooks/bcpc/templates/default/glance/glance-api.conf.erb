###############################################################################
#                           generated by chef
###############################################################################

# for an overview of all the available configuration options
# go to: https://docs.openstack.org/glance/ussuri/configuration/glance_api.html
#
[DEFAULT]
debug = <%= node['bcpc']['glance']['debug'] %>
show_image_direct_url = true
enable_v1_api = false
enable_v2_api = true
bind_host = <%= node['service_ip'] %>
bind_port = 9292
<% if node['bcpc']['glance']['workers'] %>
workers = <%= node['bcpc']['glance']['workers'] %>
<% else %>
workers = <%= node['bcpc']['openstack']['services']['workers'] %>
<% end %>
admin_role = <%= node['bcpc']['keystone']['roles']['admin'] %>
image_cache_dir = /var/lib/glance/image-cache/
log_file = /var/log/glance/api.log
transport_url = rabbit://<%= @rmqnodes.map{|x| "#{@config['rabbit']['username']}:#{@config['rabbit']['password']}@#{x['service_ip']}:5672" }.join(',') %>
image_member_quota = -1

[database]
connection = <%= "mysql+pymysql://#{@db['username']}:#{@db['password']}@#{@db['host']}:#{@db['port']}/#{@db['dbname']}" %>
max_pool_size=<%= node['bcpc']['glance']['db']['max_pool_size'] %>
max_overflow=<%= node['bcpc']['glance']['db']['max_overflow'] %>


[glance_store]
stores = rbd
default_store = rbd
rbd_store_pool = <%= node['bcpc']['glance']['ceph']['pool']['name'] %>
rbd_store_user = <%= node['bcpc']['glance']['ceph']['user'] %>
rbd_store_ceph_conf = /etc/ceph/ceph.conf


[image_format]
container_formats = <%= node['bcpc']['glance']['image_format']['container_formats'].join(',') %>
disk_formats = <%= node['bcpc']['glance']['image_format']['disk_formats'].join(',') %>


[keystone_authtoken]
auth_uri = https://<%= node['bcpc']['cloud']['fqdn'] %>:5000/v3/
auth_url = https://<%= node['bcpc']['cloud']['fqdn'] %>:35357
memcached_servers = <%= @headnodes.map{|x| "#{x['service_ip']}:11211" }.join(',') %>
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = <%= @os['username'] %>
password = <%= @os['password'] %>

[oslo_concurrency]
lock_path = /var/lock/glance

[oslo_messaging_rabbit]
amqp_durable_queues = <%= node['bcpc']['rabbitmq']['durable_queues'] %>


[paste_deploy]
flavor = keystone
